<h1>convert</h1>
<pre>
Convert makes modification in the json stored in a variable
It has the parameters as follows:
{
    "source" {<a href="json-source.html">json source</a>}
    "result" string, the name of the variable to store the result
    "add" array of {<a href="json-source.html">json source</a>}, adding looks like
         updating, but depends on ids specified in json-source.html for arrays
    "replace" array of {<a href="json-source.html">json source</a>}
    "update" array of {<a href="json-source.html">json source</a>}
    "remove" array of strings, each string identifies the path to be removed
    "filter" {
       "condition", string, condition to be evaluated for each item
       "set", array of strings, variables to be set
       "unset", array of strings, variables to be unset
       "no_empty", true or false (default). If true, empty records are removed
     } filters out the object or array by the condition and/or set/unset fields
    "push" array of {<a href="json-source.html">json source</a>}, to array next elements are added,
    "concat" array of {<a href="json-source.html">json source</a>} concatenation of arrays
    "replace_block" {
         "find_object" string name of the variable of object to be found
         "find_condition" string, condition to be verified
         "is_last" bool, the search is done until the last is found if true
         "replace_with" object to replace with
         "replace_mode" string: "before", "after" or "at" the place to replace, "after" is default
         "in_default" string: "ignore", "push","unshift", "error", the default is "error"
    }
    "for_each" {
        "pre_condition" string, optional, if not empty and evaluated false, the for_each is not executed
        "path" a path to find, including .*. in the path (for example, *.*.roles)
        "blocks", array of {
             "condition", string, condition to be verified
             "set", list of string, names of variables to be checked as set
             "unset", list of string, names of variables to be checked as unset
             "match", string, a variable name of another array or object to match, in this case,
                   the matching condition must be in the condition
             "item", name to present an item of the match, by default it is _item
          These 3 condition above are evaluated (each of them is optional) and depending on it the following
          assignments are performed:
             "then_to_whole", string, to be evaluated and assigned to the whole object
             "else_to_whole", string, to be evaluated and assigned to the whole object
               (if "delete" is used in expression, it means to delete this object)
             "then_assign",
             "else_assign" as {
                "field" string, a field name
                "value" string, a value to be evaluated
             }
             "then_collection", collection,
             "else_collection", collection,
               where the collection is as follows:
               {
                   "source": string, name of the variable to store the collection
                   "unique": array of string, names of fields to consider the insertion as unique,
                        if empty, all data will be added in one object
                   "assign": array of {
                       "field" string, name of the field, a string constant, or if starts with "$:",
                          it is evaluated at the rest after $:
                       "value" string, to be evaluated, but if it is "delete", it is just removed
                   }
                   "merge_mode" int
                       this describes how to merge values if "unique" fields are the same
                       0 - replace the whole item with a new one
                       1 - append as strings with "; " as a separator
                       2 - add new subitems, replace old subitems if the keys coincide
                       3 - add new subitems, keeping old subitems if the keys coincide
                       4 - collect the minimum value as a string
                       5 - collect the maximum value as a string
                   "append" true/false, if true, old values are kept in the collection which existed before
                      for_each, if false (default), the old values are cleaned
               }
        }
        Some variables which can be used in for_each:
        FOR_EACH_PATH_KEYS arrays of keys if path is used, each key is a part of the path.
        FOR_EACH_PATH_VALUES arrays of values corresponding to the keys above
    }
}
Example:
    ACTION_CONVERT_1=convert:{"source":"JSON_SRC", "remove":["0.value"],"return":"JSON_RESULT"}
    ACTION_CONVERT_2=convert:{"source":"S", "add":[{"var":"X"}],"result":"S"}
    ACTION_CONVERT_3=convert:{"source":"S.0.value", "replace":[{"var":"X"}],"result":"Y.pool.0"}
    ACTION_CONVERT_4=convert:{"source":"S", "update":[{"var":"X"}],"result":"S"}
</pre>
